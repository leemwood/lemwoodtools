# Scripts ç›®å½•

æœ¬ç›®å½•åŒ…å«ç”¨äºé¡¹ç›®å¼€å‘å’Œ CI/CD çš„å„ç§è„šæœ¬ã€‚

## ğŸ“ è„šæœ¬åˆ—è¡¨

### æµ‹è¯•ç»“æœè§£æè„šæœ¬

#### `parse-test-results.sh` (Linux/macOS)
ç”¨äºè§£æ JUnit XML æµ‹è¯•ç»“æœå’Œ Lint æŠ¥å‘Šçš„ Bash è„šæœ¬ã€‚

**åŠŸèƒ½**:
- è§£æ JUnit XML æµ‹è¯•ç»“æœæ–‡ä»¶
- ç»Ÿè®¡æµ‹è¯•æ€»æ•°ã€é€šè¿‡æ•°ã€å¤±è´¥æ•°ã€è·³è¿‡æ•°
- è§£æ Android Lint XML ç»“æœ
- ç»Ÿè®¡ Lint é”™è¯¯ã€è­¦å‘Šå’Œä¿¡æ¯æ•°é‡
- ç”Ÿæˆ Markdown æ ¼å¼çš„æµ‹è¯•æ‘˜è¦
- åœ¨ CI/CD ä¸­é¿å…æƒé™é—®é¢˜

**ä½¿ç”¨æ–¹æ³•**:
```bash
# ä½¿ç”¨é»˜è®¤è·¯å¾„
./scripts/parse-test-results.sh

# è‡ªå®šä¹‰è·¯å¾„ (ä¿®æ”¹è„šæœ¬ä¸­çš„å˜é‡)
TEST_RESULTS_DIR="custom/path" ./scripts/parse-test-results.sh
```

#### `parse-test-results.ps1` (Windows)
ç”¨äºè§£ææµ‹è¯•ç»“æœçš„ PowerShell è„šæœ¬ï¼ŒåŠŸèƒ½ä¸ Bash ç‰ˆæœ¬ç›¸åŒã€‚

**ä½¿ç”¨æ–¹æ³•**:
```powershell
# ä½¿ç”¨é»˜è®¤è·¯å¾„
.\scripts\parse-test-results.ps1

# è‡ªå®šä¹‰è·¯å¾„
.\scripts\parse-test-results.ps1 -TestResultsDir "custom\path" -LintResultsDir "custom\lint\path" -OutputFile "custom-summary.md"
```

**å‚æ•°**:
- `TestResultsDir`: æµ‹è¯•ç»“æœç›®å½•è·¯å¾„ (é»˜è®¤: `app\build\test-results\testDebugUnitTest`)
- `LintResultsDir`: Lint ç»“æœç›®å½•è·¯å¾„ (é»˜è®¤: `app\build\reports`)
- `OutputFile`: è¾“å‡ºæ–‡ä»¶è·¯å¾„ (é»˜è®¤: `test-summary.md`)

## ğŸ”§ èƒŒæ™¯è¯´æ˜

### ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æµ‹è¯•ç»“æœè§£æï¼Ÿ

åœ¨ GitHub Actions ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹æµ‹è¯•ç»“æœå‘å¸ƒ Action (`EnricoMi/publish-unit-test-result-action@v2`) çš„æƒé™é—®é¢˜ï¼š

```
github.GithubException.GithubException: 403 {"message": "Resource not accessible by integration", "documentation_url": "https://docs.github.com/rest/checks/runs#create-a-check-run", "status": "403"}
```

**é—®é¢˜åŸå› **:
- GitHub Actions çš„ `GITHUB_TOKEN` é»˜è®¤æƒé™ä¸è¶³ä»¥åˆ›å»º check runs
- å³ä½¿æ·»åŠ äº† `checks: write` æƒé™ï¼ŒæŸäº›ä»“åº“é…ç½®ä»å¯èƒ½é™åˆ¶æ­¤åŠŸèƒ½

**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»ºè‡ªå®šä¹‰è„šæœ¬è§£ææµ‹è¯•ç»“æœ
- ä½¿ç”¨ GitHub Step Summary æ˜¾ç¤ºç»“æœ
- å°†æµ‹è¯•æ‘˜è¦ä½œä¸º artifact ä¸Šä¼ 
- é¿å…ä¾èµ–éœ€è¦ç‰¹æ®Šæƒé™çš„ç¬¬ä¸‰æ–¹ Actions

## ğŸ“‹ å‰ææ¡ä»¶

### å¯¹äºæµ‹è¯•ç»“æœè§£æè„šæœ¬

#### Linux/macOS
- `bash` (é€šå¸¸é¢„è£…)
- `grep`, `sed` (é€šå¸¸é¢„è£…)

#### Windows
- PowerShell 5.1 æˆ–æ›´é«˜ç‰ˆæœ¬

## ğŸš€ ä½¿ç”¨æµç¨‹

### åœ¨ CI/CD ä¸­ä½¿ç”¨ (è‡ªåŠ¨)

è„šæœ¬åœ¨ GitHub Actions å·¥ä½œæµç¨‹ä¸­è‡ªåŠ¨è¿è¡Œï¼š

```yaml
- name: Generate test summary
  run: |
    chmod +x scripts/parse-test-results.sh
    scripts/parse-test-results.sh
    
- name: Add test summary to job summary
  if: always()
  run: |
    if [ -f "test-summary.md" ]; then
      cat test-summary.md >> $GITHUB_STEP_SUMMARY
    fi
```

### æœ¬åœ°ä½¿ç”¨

#### Linux/macOS:
```bash
# è¿è¡Œæµ‹è¯•
./gradlew testDebugUnitTest lintDebug

# è§£æç»“æœ
chmod +x scripts/parse-test-results.sh
./scripts/parse-test-results.sh

# æŸ¥çœ‹æ‘˜è¦
cat test-summary.md
```

#### Windows:
```powershell
# è¿è¡Œæµ‹è¯•
.\gradlew.bat testDebugUnitTest lintDebug

# è§£æç»“æœ
.\scripts\parse-test-results.ps1

# æŸ¥çœ‹æ‘˜è¦
Get-Content test-summary.md
```

## ğŸ“Š è¾“å‡ºæ ¼å¼

è„šæœ¬ç”Ÿæˆçš„æµ‹è¯•æ‘˜è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

```markdown
# ğŸ§ª Test Results Summary

Generated on: 2024-01-15 10:30:00

## Unit Tests

- **TEST-com.example.ExampleUnitTest.xml**: 4 tests, 0 failures, 0 skipped

### Summary
- **Total Tests**: 4
- **Passed**: 4
- **Failed**: 0
- **Skipped**: 0
- **Status**: âœ… All tests passed!

## Lint Results

- **lint-results-debug.xml**:
  - Errors: 0
  - Warnings: 2
  - Info: 5

---
*Generated by parse-test-results.sh*
```

## ğŸ” æ•…éšœæ’é™¤

### æµ‹è¯•ç»“æœè§£æé—®é¢˜

#### 1. æµ‹è¯•ç»“æœæ–‡ä»¶æœªæ‰¾åˆ°
**ç—‡çŠ¶**: "âŒ No test results found" æ¶ˆæ¯
**è§£å†³æ–¹æ¡ˆ**: 
- ç¡®ä¿å·²è¿è¡Œæµ‹è¯•: `./gradlew testDebugUnitTest`
- æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®: `app/build/test-results/testDebugUnitTest/`
- éªŒè¯æµ‹è¯•æ˜¯å¦æˆåŠŸå®Œæˆ

#### 2. Lint ç»“æœæ–‡ä»¶æœªæ‰¾åˆ°
**ç—‡çŠ¶**: "âš ï¸ No lint result files found" æ¶ˆæ¯
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿å·²è¿è¡Œ Lint: `./gradlew lintDebug`
- æ£€æŸ¥ Lint é…ç½®æ˜¯å¦æ­£ç¡®
- éªŒè¯è¾“å‡ºæ ¼å¼ä¸º XML: `app/build/reports/lint-results-*.xml`

#### 3. XML è§£æé”™è¯¯
**ç—‡çŠ¶**: è„šæœ¬æ‰§è¡Œå‡ºé”™æˆ–æ•°æ®ä¸æ­£ç¡®
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ XML æ–‡ä»¶æ˜¯å¦å®Œæ•´å’Œæœ‰æ•ˆ
- éªŒè¯æ–‡ä»¶ç¼–ç  (åº”ä¸º UTF-8)
- ç¡®ä¿æ²¡æœ‰è¯­æ³•é”™è¯¯
- æ£€æŸ¥ XML ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸæ ¼å¼

#### 4. æƒé™é—®é¢˜ (Linux/macOS)
**ç—‡çŠ¶**: "Permission denied" é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
```bash
chmod +x scripts/parse-test-results.sh
```

#### 5. PowerShell æ‰§è¡Œç­–ç•¥é—®é¢˜ (Windows)
**ç—‡çŠ¶**: "execution of scripts is disabled" é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### è„šæœ¬å®‰å…¨
- å®¡æŸ¥è„šæœ¬å†…å®¹åå†è¿è¡Œ
- ä¸è¦åœ¨ä¸å—ä¿¡ä»»çš„ç¯å¢ƒä¸­è¿è¡Œ
- ç¡®ä¿è„šæœ¬æ¥æºå¯é 
- å®šæœŸæ›´æ–°è„šæœ¬ä»¥ä¿®å¤å®‰å…¨é—®é¢˜

### æ•°æ®éšç§
- æµ‹è¯•ç»“æœå¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯
- ç¡®ä¿é€‚å½“çš„è®¿é—®æ§åˆ¶
- æ³¨æ„ artifact çš„ä¿ç•™æœŸé™
- é¿å…åœ¨å…¬å…±æ—¥å¿—ä¸­æš´éœ²æ•æ„Ÿæ•°æ®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [CI/CD å·¥ä½œæµç¨‹](../CICD.md)
- [å¼€å‘æŒ‡å—](../DEVELOPMENT.md)
- [æ¶æ„æŒ‡å—](../ARCHITECTURE.md)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [JUnit XML æ ¼å¼](https://llg.cubic.org/docs/junit/)
- [Android Lint æ–‡æ¡£](https://developer.android.com/studio/write/lint)

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥å‰ææ¡ä»¶**: ç¡®ä¿æ‰€æœ‰å¿…éœ€å·¥å…·å·²å®‰è£…
2. **æŸ¥çœ‹é”™è¯¯ä¿¡æ¯**: ä»”ç»†é˜…è¯»é”™è¯¯æ¶ˆæ¯å’Œè„šæœ¬è¾“å‡º
3. **æ£€æŸ¥æ–‡ä»¶è·¯å¾„**: éªŒè¯æµ‹è¯•ç»“æœå’Œ Lint æŠ¥å‘Šçš„ä½ç½®
4. **è¿è¡Œæµ‹è¯•**: ç¡®ä¿æµ‹è¯•å’Œ Lint æ£€æŸ¥å·²æˆåŠŸå®Œæˆ
5. **å‚è€ƒæ–‡æ¡£**: æŸ¥çœ‹ç›¸å…³æ–‡æ¡£å’Œç¤ºä¾‹
6. **æäº¤ Issue**: åœ¨ GitHub ä»“åº“ä¸­æŠ¥å‘Šé—®é¢˜

## ğŸ“ è´¡çŒ®

æ¬¢è¿æ”¹è¿›è¿™äº›è„šæœ¬ï¼è¯·éµå¾ªä»¥ä¸‹å‡†åˆ™ï¼š

- ä¿æŒå‘åå…¼å®¹æ€§
- æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†
- æ›´æ–°æ–‡æ¡£
- æµ‹è¯•åœ¨ä¸åŒå¹³å°ä¸Šçš„å…¼å®¹æ€§
- éµå¾ªå®‰å…¨æœ€ä½³å®è·µ
- è€ƒè™‘ä¸åŒçš„æµ‹è¯•æ¡†æ¶å’Œå·¥å…·

## ğŸ”„ æœªæ¥æ”¹è¿›

è®¡åˆ’ä¸­çš„åŠŸèƒ½ï¼š
- [ ] æ”¯æŒæ›´å¤šæµ‹è¯•æ¡†æ¶ (Espresso, Robolectric)
- [ ] é›†æˆä»£ç è¦†ç›–ç‡æŠ¥å‘Š
- [ ] æ”¯æŒè‡ªå®šä¹‰æŠ¥å‘Šæ¨¡æ¿
- [ ] æ·»åŠ æ€§èƒ½æµ‹è¯•ç»“æœè§£æ
- [ ] æ”¯æŒå¤šæ¨¡å—é¡¹ç›®
- [ ] ç”Ÿæˆ HTML æ ¼å¼æŠ¥å‘Š